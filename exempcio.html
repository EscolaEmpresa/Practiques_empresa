<!DOCTYPE html>
<html lang="ca" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia Interactiva de Procediments</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Slate Neutrals -->
    <!-- Application Structure Plan: He dissenyat l'aplicaci贸 com un "llen莽 infinit" explorable. L'usuari comen莽a centrat en el primer pas. Cada decisi贸 activa una transici贸 CSS (transform: translate) que despla莽a suaument el llen莽 per centrar el seg眉ent pas a la vista. Aquesta arquitectura simula el moviment a trav茅s d'un diagrama de flux f铆sic, fent que el recorregut sigui intu茂tiu i visualment coherent. Els botons de "Vista General" i "Reiniciar" ofereixen control sobre la navegaci贸 global. -->
    <!-- Visualization & Content Choices: 
        - Diagrama de Flux Dinmic: Objectiu=Guiar/Organitzar. M猫tode=Nodes (divs) posicionats absolutament en un contenidor pare ("m贸n") que es despla莽a. Fletxes generades amb JS/CSS per connectar els nodes. Interacci贸=Clicar botons d'opci贸 per iniciar la transici贸 al node seg眉ent. Justificaci贸=Aquesta 茅s la implementaci贸 m茅s directa de la sol路licitud de l'usuari d'una "presentaci贸 que es mou", creant una experi猫ncia d'usuari m茅s immersiva i semblant a un joc.
        - Nodes de contingut: Cada pas del procediment 茅s una "carta" autocontinguda, fcil de modificar a l'HTML. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e2e8f0; /* Slate 200 */
        }
        #viewport {
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
            cursor: grab;
        }
        #viewport:active {
            cursor: grabbing;
        }
        .node-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        .node-card.active {
            border-color: #4f46e5; /* Indigo 600 */
            transform: scale(1.05);
        }
        .option-btn {
            background-color: #4f46e5; /* Indigo 600 */
            color: white;
            transition: background-color 0.2s;
        }
        .option-btn:hover {
            background-color: #4338ca; /* Indigo 700 */
        }
        .control-btn {
             background-color: rgba(255, 255, 255, 0.9);
             backdrop-filter: blur(5px);
             border: 1px solid #e2e8f0; /* Slate 200 */
        }
        .arrow-line {
            background-color: #94a3b8; /* Slate 400 */
            height: 2px;
            position: absolute;
            transform-origin: 0 0;
            transition: opacity 0.3s ease-in-out;
        }
        .arrow-head {
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 6px 0 6px 12px;
            border-color: transparent transparent transparent #94a3b8; /* Slate 400 */
            transform-origin: 0 50%;
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="overflow-hidden">

    <div id="viewport" class="relative w-full h-screen overflow-hidden">
        <div id="world" class="absolute transition-transform duration-700 ease-in-out" style="transform: translate(0px, 0px) scale(1);">
            <div id="arrow-container"></div>
            
            <!-- PAS INICIAL -->
            <div id="node-start" class="node-card absolute p-6 w-96" style="top: 100px; left: 1000px;">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Inici: Exempci贸 de l'estada a l'empresa</h3>
                <p class="text-slate-600 mb-4 text-sm">Quin tipus de prctica est cursant l'alumne?</p>
                <div class="flex flex-col gap-2">
                    <button data-target="node-dual-general-start" class="option-btn w-full text-left p-3 rounded-lg text-sm font-semibold">Dual General</button>
                    <button data-target="node-intensiva-fi" class="option-btn w-full text-left p-3 rounded-lg text-sm font-semibold">Dual Intensiva</button>
                </div>
            </div>

            <div id="node-intensiva-fi" class="node-card absolute p-8 w-96 hidden" style="top: 100px; left: 1500px;">
                <h3 class="text-2xl font-bold text-amber-600 mb-4">Exempci贸 No Possible</h3>
                <p class="text-slate-600">A la formaci贸 en **Dual Intensiva no 茅s possible fer exempcions** de l'estada a l'empresa. L'alumne ha de cursar la totalitat de les hores.</p>
            </div>

            <div id="node-dual-general-start" class="node-card absolute p-6 w-96 hidden" style="top: 450px; left: 1000px;">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Sol路licitud d'Exempci贸 Dual General</h3>
                <p class="text-slate-600 mb-4 text-sm">Quin percentatge d'exempci贸 demana l'alumne?</p>
                <div class="flex flex-col gap-2">
                    <button data-target="node-exempcio-25" class="option-btn w-full text-left p-3 rounded-lg text-sm font-semibold">Exempci贸 Parcial del 25%</button>
                    <button data-target="node-exempcio-50" class="option-btn w-full text-left p-3 rounded-lg text-sm font-semibold">Exempci贸 Parcial del 50%</button>
                    <button data-target="node-exempcio-100" class="option-btn w-full text-left p-3 rounded-lg text-sm font-semibold">Exempci贸 Total del 100%</button>
                </div>
            </div>

            <!-- RUTA 25% -->
            <div id="node-exempcio-25" class="node-card absolute p-6 w-96 hidden" style="top: 800px; left: 400px;">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Requisits Exempci贸 25%</h3>
                <p class="text-slate-600 mb-4 text-sm">La feina no cal que estigui relacionada amb el cicle. L'alumne ha de presentar:</p>
                <ul class="list-disc list-inside text-slate-600 space-y-2 text-sm">
                    <li>Sol路licitud de convalidaci贸 (<strong>FML43</strong>).</li>
                    <li><strong>Vida laboral</strong> amb experi猫ncia equivalent al <strong>doble de les hores totals</strong> de la Dual General.</li>
                </ul>
                <div class="flex flex-col gap-2 mt-4">
                    <button data-target="node-final" class="option-btn w-full text-left p-3 rounded-lg text-sm font-semibold">Anar als passos finals</button>
                </div>
            </div>
            
            <!-- RUTA 50% -->
            <div id="node-exempcio-50" class="node-card absolute p-6 w-96 hidden" style="top: 800px; left: 1000px;">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Requisits Exempci贸 50%</h3>
                <p class="text-slate-600 mb-4 text-sm">La feina <strong>ha d'estar relacionada</strong> amb el cicle i l'experi猫ncia ha de ser <strong>superior al 50% de les hores</strong> de la Dual General.</p>
                 <div class="flex flex-col gap-2">
                    <button data-target="node-autonom-check-50" class="option-btn w-full text-left p-3 rounded-lg text-sm font-semibold">Comprovar documentaci贸</button>
                </div>
            </div>
            
            <div id="node-autonom-check-50" class="node-card absolute p-6 w-96 hidden" style="top: 1150px; left: 1000px;">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Tipus de Treballador (50%)</h3>
                <p class="text-slate-600 mb-4 text-sm">L'alumne treballa per compte d'altri o 茅s aut貌nom?</p>
                 <div class="flex flex-col gap-2">
                    <button data-target="node-documents-50-altri" class="option-btn w-full text-left p-3 rounded-lg text-sm font-semibold">Compte d'altri</button>
                    <button data-target="node-documents-50-autonom" class="option-btn w-full text-left p-3 rounded-lg text-sm font-semibold">Aut貌nom</button>
                </div>
            </div>
            
            <div id="node-documents-50-altri" class="node-card absolute p-6 w-96 hidden" style="top: 1500px; left: 800px;">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Documentaci贸 (50% - Compte d'altri)</h3>
                <ul class="list-disc list-inside text-slate-600 space-y-2 text-sm">
                    <li>Sol路licitud de convalidaci贸 (<strong>FML43</strong>).</li>
                    <li><strong>Certificat d'empresa</strong> amb les tasques detallades.</li>
                    <li>Fotoc貌pia del <strong>contracte laboral</strong> compulsada.</li>
                    <li>Informe d'aprovaci贸 del tutor (<strong>FML80</strong>).</li>
                </ul>
                 <div class="flex flex-col gap-2 mt-4">
                    <button data-target="node-final" class="option-btn w-full text-left p-3 rounded-lg text-sm font-semibold">Anar als passos finals</button>
                </div>
            </div>

            <div id="node-documents-50-autonom" class="node-card absolute p-6 w-96 hidden" style="top: 1500px; left: 1200px;">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Documentaci贸 (50% - Aut貌nom)</h3>
                <ul class="list-disc list-inside text-slate-600 space-y-2 text-sm">
                    <li>Sol路licitud de convalidaci贸 (<strong>FML43</strong>).</li>
                    <li><strong>Certificat d'alta</strong> al r猫gim d'aut貌noms.</li>
                    <li><strong>Declaraci贸 de l'interessat</strong> de les activitats representatives.</li>
                    <li>Informe d'aprovaci贸 del tutor (<strong>FML80</strong>).</li>
                </ul>
                 <div class="flex flex-col gap-2 mt-4">
                    <button data-target="node-final" class="option-btn w-full text-left p-3 rounded-lg text-sm font-semibold">Anar als passos finals</button>
                </div>
            </div>


            <!-- RUTA 100% -->
            <div id="node-exempcio-100" class="node-card absolute p-6 w-96 hidden" style="top: 800px; left: 1600px;">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Requisits Exempci贸 100%</h3>
                <p class="text-slate-600 mb-4 text-sm">La feina <strong>ha d'estar relacionada</strong> amb el cicle i el temps treballat ha de ser <strong>superior al total d'hores</strong> de la Dual General.</p>
                 <div class="flex flex-col gap-2">
                    <button data-target="node-autonom-check-100" class="option-btn w-full text-left p-3 rounded-lg text-sm font-semibold">Comprovar documentaci贸</button>
                </div>
            </div>

             <div id="node-autonom-check-100" class="node-card absolute p-6 w-96 hidden" style="top: 1150px; left: 1600px;">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Tipus de Treballador (100%)</h3>
                <p class="text-slate-600 mb-4 text-sm">L'alumne treballa per compte d'altri o 茅s aut貌nom?</p>
                 <div class="flex flex-col gap-2">
                    <button data-target="node-documents-100-altri" class="option-btn w-full text-left p-3 rounded-lg text-sm font-semibold">Compte d'altri</button>
                    <button data-target="node-documents-100-autonom" class="option-btn w-full text-left p-3 rounded-lg text-sm font-semibold">Aut貌nom</button>
                </div>
            </div>

            <div id="node-documents-100-altri" class="node-card absolute p-6 w-96 hidden" style="top: 1500px; left: 1400px;">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Documentaci贸 (100% - Compte d'altri)</h3>
                <ul class="list-disc list-inside text-slate-600 space-y-2 text-sm">
                    <li>Sol路licitud de convalidaci贸 (<strong>FML43</strong>).</li>
                    <li><strong>Certificat d'empresa</strong> amb les tasques detallades.</li>
                    <li>Fotoc貌pia del <strong>contracte laboral</strong> compulsada.</li>
                    <li>Informe d'aprovaci贸 del tutor (<strong>FML80</strong>).</li>
                </ul>
                 <div class="flex flex-col gap-2 mt-4">
                    <button data-target="node-final" class="option-btn w-full text-left p-3 rounded-lg text-sm font-semibold">Anar als passos finals</button>
                </div>
            </div>

            <div id="node-documents-100-autonom" class="node-card absolute p-6 w-96 hidden" style="top: 1500px; left: 1800px;">
                 <h3 class="text-xl font-bold text-slate-800 mb-2">Documentaci贸 (100% - Aut貌nom)</h3>
                <ul class="list-disc list-inside text-slate-600 space-y-2 text-sm">
                     <li>Sol路licitud de convalidaci贸 (<strong>FML43</strong>).</li>
                     <li><strong>Certificat d'alta</strong> al r猫gim d'aut貌noms.</li>
                     <li><strong>Declaraci贸 de l'interessat</strong> de les activitats representatives.</li>
                     <li>Informe d'aprovaci贸 del tutor (<strong>FML80</strong>).</li>
                </ul>
                 <div class="flex flex-col gap-2 mt-4">
                    <button data-target="node-final" class="option-btn w-full text-left p-3 rounded-lg text-sm font-semibold">Anar als passos finals</button>
                </div>
            </div>
            
            <!-- PAS FINAL -->
            <div id="node-final" class="node-card absolute p-8 w-[500px] hidden" style="top: 1900px; left: 1000px;">
                <h3 class="text-2xl font-bold text-green-600 mb-4">Procediment Finalitzat</h3>
                <p class="text-slate-600 mb-4">Un cop recollida i validada tota la documentaci贸 correcta:</p>
                <ul class="list-disc list-inside text-slate-600 space-y-2 mb-6">
                    <li>El coordinador ha de validar la proposta d'exempci贸.</li>
                    <li>S'ha d'indicar l'exempci贸 al quadern de prctiques de l'alumne.</li>
                </ul>
                <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md mb-4">
                    <p class="font-bold">Molt Important!</p>
                    <p class="text-sm">S'ha de registrar l'exempci贸 (fins i tot la del 100%) al SBid. En cas contrari, no computar en el clcul anual d'alumnes en prctiques i el centre podria perdre hores de reducci贸.</p>
                </div>
                 <div class="flex flex-col gap-2">
                    <button data-target="node-sbid-tutorial" class="option-btn w-full text-left p-3 rounded-lg text-sm font-semibold">Com registrar l'exempci贸 al SBid?</button>
                </div>
            </div>

            <div id="node-sbid-tutorial" class="node-card absolute p-8 w-[600px] hidden" style="top: 2300px; left: 1000px;">
                <h3 class="text-2xl font-bold text-slate-800 mb-4">Annex: Opcions per a registrar Exempci贸 al SBid</h3>
                <div class="text-slate-600 space-y-4 text-sm">
                    <div>
                        <p class="font-bold mb-1">1. Crear el quadern amb l'exempci贸 ja indicada:</p>
                        <p class="mb-2">Si ho saps per endavant, indica el percentatge al crear el quadern.</p>
                        <div class="p-2 border rounded-lg bg-slate-50">
                             <img id="img-sbid-1" src="https://raw.githubusercontent.com/EscolaEmpresa/Practiques_empresa/efee0a26e4a6b0d6bc5aaeace7d6c7c920e4dc0c/imatges/Exempcio/PercentatgeQuadern.png" alt="Imatge del formulari de creaci贸 del quadern" class="w-full rounded-md">
                        </div>
                    </div>
                     <div>
                        <p class="font-bold mb-1">2. Modificar un quadern ja creat (fins a 50%):</p>
                        <p class="mb-2">Per a un quadern existent, busca el bot贸 de modificar (icona de llapis).</p>
                        <div class="p-2 border rounded-lg bg-slate-50">
                            <img id="img-sbid-2" src="https://raw.githubusercontent.com/EscolaEmpresa/Practiques_empresa/efee0a26e4a6b0d6bc5aaeace7d6c7c920e4dc0c/imatges/Exempcio/ModificarQuadern.png" alt="Imatge del bot贸 per modificar el quadern" class="w-full rounded-md">
                        </div>
                         <p class="mt-2 mb-2">Des d'aqu铆 podrs canviar l'exempci贸 fins a un mxim del 50%.</p>
                          <div class="p-2 border rounded-lg bg-slate-50">
                            <img id="img-sbid-3" src="https://raw.githubusercontent.com/EscolaEmpresa/Practiques_empresa/efee0a26e4a6b0d6bc5aaeace7d6c7c920e4dc0c/imatges/Exempcio/ModificarQuadern2.png" alt="Imatge del selector d'exempci贸 fins a 50%" class="w-full rounded-md">
                        </div>
                    </div>
                     <div>
                        <p class="font-bold mb-1">3. Modificar un quadern ja creat (100%):</p>
                        <p class="mb-2">Per a l'exempci贸 total en un quadern ja creat, has d'anar a la pestanya de "Reconeixements" i seleccionar "EXEMPCI DEL 100%".</p>
                         <div class="p-2 border rounded-lg bg-slate-50">
                            <img id="img-sbid-4" src="https://raw.githubusercontent.com/EscolaEmpresa/Practiques_empresa/efee0a26e4a6b0d6bc5aaeace7d6c7c920e4dc0c/imatges/Exempcio/Reconeixement100%25.png" alt="Imatge de la pestanya de reconeixements" class="w-full rounded-md">
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    
    <div class="absolute top-4 right-4 space-x-2">
        <a href="index.html" class="control-btn p-2 rounded-md font-semibold text-sm text-slate-700 inline-block"> Tornar a l'inici</a>
        <button id="overview-btn" class="control-btn p-2 rounded-md font-semibold text-sm text-slate-700"> Vista General</button>
        <button id="restart-btn" class="control-btn p-2 rounded-md font-semibold text-sm text-slate-700"> Reiniciar</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const world = document.getElementById('world');
            const viewport = document.getElementById('viewport');
            const nodes = document.querySelectorAll('.node-card');
            const arrowContainer = document.getElementById('arrow-container');
            let activeNode = document.getElementById('node-start');
            let history = ['node-start'];
            
            let currentScale = 1;
            let currentTranslateX = 0;
            let currentTranslateY = 0;

            let isPanning = false;
            let startX, startY, initialTranslateX, initialTranslateY;

            const arrowsConfig = [
                { from: 'node-start', to: 'node-dual-general-start' },
                { from: 'node-start', to: 'node-intensiva-fi' },
                { from: 'node-dual-general-start', to: 'node-exempcio-25' },
                { from: 'node-dual-general-start', to: 'node-exempcio-50' },
                { from: 'node-dual-general-start', to: 'node-exempcio-100' },
                { from: 'node-exempcio-25', to: 'node-final' },
                { from: 'node-exempcio-50', to: 'node-autonom-check-50' },
                { from: 'node-autonom-check-50', to: 'node-documents-50-altri' },
                { from: 'node-autonom-check-50', to: 'node-documents-50-autonom' },
                { from: 'node-documents-50-altri', to: 'node-final' },
                { from: 'node-documents-50-autonom', to: 'node-final' },
                { from: 'node-exempcio-100', to: 'node-autonom-check-100' },
                { from: 'node-autonom-check-100', to: 'node-documents-100-altri' },
                { from: 'node-autonom-check-100', to: 'node-documents-100-autonom' },
                { from: 'node-documents-100-altri', to: 'node-final' },
                { from: 'node-documents-100-autonom', to: 'node-final' },
                { from: 'node-final', to: 'node-sbid-tutorial' }
            ];

            function drawArrow(fromNode, toNode) {
                if (!fromNode || !toNode) return;
                const fromRect = { x: fromNode.offsetLeft, y: fromNode.offsetTop, w: fromNode.offsetWidth, h: fromNode.offsetHeight };
                const toRect = { x: toNode.offsetLeft, y: toNode.offsetTop, w: toNode.offsetWidth, h: toNode.offsetHeight };
                let fromX, fromY, toX, toY;
                const dx = (toRect.x + toRect.w / 2) - (fromRect.x + fromRect.w / 2);
                const dy = (toRect.y + toRect.h / 2) - (fromRect.y + fromRect.h / 2);
                if (Math.abs(dx) > Math.abs(dy)) {
                    if (dx > 0) { fromX = fromRect.x + fromRect.w; fromY = fromRect.y + fromRect.h / 2; toX = toRect.x; toY = toRect.y + toRect.h / 2; }
                    else { fromX = fromRect.x; fromY = fromRect.y + fromRect.h / 2; toX = toRect.x + toRect.w; toY = toRect.y + toRect.h / 2; }
                } else {
                    if (dy > 0) { fromX = fromRect.x + fromRect.w / 2; fromY = fromRect.y + fromRect.h; toX = toRect.x + toRect.w / 2; toY = toRect.y; }
                    else { fromX = fromRect.x + fromRect.w / 2; fromY = fromRect.y; toX = toRect.x + toRect.w / 2; toY = toRect.y + toRect.h; }
                }
                const angle = Math.atan2(toY - fromY, toX - fromX);
                const length = Math.sqrt(Math.pow(toX - fromX, 2) + Math.pow(toY - fromY, 2));
                const line = document.createElement('div');
                line.className = 'arrow-line';
                line.style.left = `${fromX}px`;
                line.style.top = `${fromY}px`;
                line.style.width = `${length}px`;
                line.style.transform = `rotate(${angle}rad)`;
                const head = document.createElement('div');
                head.className = 'arrow-head';
                head.style.left = `${toX}px`;
                head.style.top = `${toY}px`;
                head.style.transform = `translate(-6px, -6px) rotate(${angle * 180 / Math.PI}deg)`;
                arrowContainer.appendChild(line);
                arrowContainer.appendChild(head);
            }

            function updatePathArrows() {
                arrowContainer.innerHTML = '';
                if (history.length < 2) return;
                for (let i = 0; i < history.length - 1; i++) {
                    const fromNode = document.getElementById(history[i]);
                    const toNode = document.getElementById(history[i + 1]);
                    drawArrow(fromNode, toNode);
                }
            }

            function drawAllArrows() {
                arrowContainer.innerHTML = '';
                arrowsConfig.forEach(config => {
                    const fromNode = document.getElementById(config.from);
                    const toNode = document.getElementById(config.to);
                    drawArrow(fromNode, toNode);
                });
            }

            function panToNode(nodeId, immediate = false) {
                const targetNode = document.getElementById(nodeId);
                if (!targetNode) return;
                
                if (activeNode) activeNode.classList.remove('active');
                activeNode = targetNode;
                activeNode.classList.add('active');
                activeNode.classList.remove('hidden');

                const viewportWidth = viewport.clientWidth;
                const viewportHeight = viewport.clientHeight;
                const nodeCenter = {
                    x: targetNode.offsetLeft + targetNode.offsetWidth / 2,
                    y: targetNode.offsetTop + targetNode.offsetHeight / 2
                };
                
                currentScale = 1;
                currentTranslateX = viewportWidth / 2 - nodeCenter.x * currentScale;
                currentTranslateY = viewportHeight / 2 - nodeCenter.y * currentScale;

                if (immediate) world.style.transitionDuration = '0s';
                world.style.transform = `translate(${currentTranslateX}px, ${currentTranslateY}px) scale(${currentScale})`;
                if (immediate) setTimeout(() => world.style.transitionDuration = '0.7s', 50);
                
                updatePathArrows();
            }

            viewport.addEventListener('click', (e) => {
                const targetButton = e.target.closest('button[data-target]');
                if (targetButton) {
                    const targetNodeId = targetButton.dataset.target;
                    const parentNode = targetButton.closest('.node-card');
                    const parentNodeId = parentNode.id;

                    const parentIndex = history.indexOf(parentNodeId);
                    if (parentIndex > -1) {
                        history.splice(parentIndex + 1);
                    } else {
                        // Si el node no es troba, reinicia el cam铆 des d'aquest node
                        history = [parentNodeId];
                    }
                    history.push(targetNodeId);
                    panToNode(targetNodeId);
                }
            });

            document.getElementById('restart-btn').addEventListener('click', () => {
                nodes.forEach(node => {
                    if (node.id !== 'node-start') node.classList.add('hidden');
                });
                history = ['node-start'];
                panToNode('node-start', true);
            });

            document.getElementById('overview-btn').addEventListener('click', () => {
                if (activeNode) activeNode.classList.remove('active');
                nodes.forEach(node => node.classList.remove('hidden'));
                drawAllArrows();

                let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
                nodes.forEach(node => {
                    minX = Math.min(minX, node.offsetLeft);
                    minY = Math.min(minY, node.offsetTop);
                    maxX = Math.max(maxX, node.offsetLeft + node.offsetWidth);
                    maxY = Math.max(maxY, node.offsetTop + node.offsetHeight);
                });

                const worldWidth = maxX - minX;
                const worldHeight = maxY - minY;
                const viewportWidth = viewport.clientWidth;
                const viewportHeight = viewport.clientHeight;
                const scaleX = viewportWidth / worldWidth * 0.9;
                const scaleY = viewportHeight / worldHeight * 0.9;
                currentScale = Math.min(scaleX, scaleY, 1);
                const centerX = minX + worldWidth / 2;
                const centerY = minY + worldHeight / 2;
                currentTranslateX = viewportWidth / 2 - centerX * currentScale;
                currentTranslateY = viewportHeight / 2 - centerY * currentScale;
                world.style.transform = `translate(${currentTranslateX}px, ${currentTranslateY}px) scale(${currentScale})`;
            });

            viewport.addEventListener('mousedown', (e) => {
                if (e.target.closest('button')) return;
                e.preventDefault();
                isPanning = true;
                startX = e.clientX;
                startY = e.clientY;
                initialTranslateX = currentTranslateX;
                initialTranslateY = currentTranslateY;
                world.style.transitionDuration = '0s';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isPanning) return;
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                currentTranslateX = initialTranslateX + dx;
                currentTranslateY = initialTranslateY + dy;
                world.style.transform = `translate(${currentTranslateX}px, ${currentTranslateY}px) scale(${currentScale})`;
            });

            document.addEventListener('mouseup', () => {
                if (isPanning) {
                    isPanning = false;
                    world.style.transitionDuration = '0.7s';
                }
            });
            
            viewport.addEventListener('wheel', (e) => {
                e.preventDefault();
                const zoomFactor = 1.1;
                const rect = viewport.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                const worldX = (mouseX - currentTranslateX) / currentScale;
                const worldY = (mouseY - currentTranslateY) / currentScale;
                const newScale = e.deltaY < 0 ? currentScale * zoomFactor : currentScale / zoomFactor;
                const minScale = 0.2, maxScale = 2;
                currentScale = Math.max(minScale, Math.min(maxScale, newScale));
                currentTranslateX = mouseX - worldX * currentScale;
                currentTranslateY = mouseY - worldY * currentScale;
                world.style.transitionDuration = '0.1s';
                world.style.transform = `translate(${currentTranslateX}px, ${currentTranslateY}px) scale(${currentScale})`;
                setTimeout(() => world.style.transitionDuration = '0.7s', 100);
            });

            nodes.forEach(node => {
                if (node.id !== 'node-start') node.classList.add('hidden');
            });
            panToNode('node-start', true);
        });
    </script>
</body>
</html>


